<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bivencas Crypto Tycoon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #141414;
            --accent: #e11d48;
            --accent-hover: #fb7185;
            --text: #ffffff;
            --gray: #71717a;
            --green: #22c55e;
            --red: #ef4444;
            --yellow: #facc15;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0; padding: 0;
            overflow: hidden; /* Prevent scrolling issues */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container { height: 100vh; display: flex; flex-direction: column; }

        .page { display: none; flex: 1; padding: 20px; overflow-y: auto; padding-bottom: 100px; animation: fadeIn 0.3s ease-out; }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .tab-bar {
            position: fixed; bottom: 0; width: 100%;
            background: #000; display: flex; justify-content: space-around;
            padding: 15px 0; border-top: 1px solid #27272a; z-index: 1000;
        }
        .tab-item { text-align: center; color: var(--gray); font-size: 10px; cursor: pointer; flex: 1; transition: 0.2s; }
        .tab-item.active { color: var(--accent); }
        .tab-item span { display: block; font-size: 20px; margin-bottom: 4px; }

        /* –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        .btn {
            background: var(--accent); color: white; border: none;
            padding: 14px 20px; border-radius: 12px; font-weight: bold;
            width: 100%; transition: 0.2s; cursor: pointer;
        }
        .btn:hover:not(:disabled) { background: var(--accent-hover); }
        .btn:disabled { background: #27272a; color: #52525b; cursor: not-allowed; }
        input { background: #1a1a1a; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }

        /* –ë–∞–ª–∞–Ω—Å –∏ –ü—Ä–æ—Ñ–∏–ª—å */
        .balance-info {
            background: linear-gradient(135deg, #1e1b4b, #431407); /* Dark purple-red gradient */
            padding: 30px; border-radius: 24px; text-align: center;
            border: 1px solid #e11d4844; margin-bottom: 20px;
        }
        .balance-label { font-size: 14px; opacity: 0.6; margin-bottom: 5px; }
        .balance-value { font-size: 42px; font-weight: 800; color: var(--accent); text-shadow: 0 0 15px #e11d4844; }
        .crypto-balance-value { font-size: 24px; font-weight: 600; color: var(--yellow); margin-top: 10px; }
        .profile-nick { font-size: 24px; font-weight: bold; margin-bottom: 10px; }

        /* –ì–ª–∞–≤–Ω–∞—è - –º–∞–π–Ω–∏–Ω–≥ */
        .mining-area { text-align: center; margin-top: 20px; }
        .mining-button {
            width: 150px; height: 150px; border-radius: 50%; background: var(--accent);
            display: flex; align-items: center; justify-content: center;
            font-size: 80px; font-weight: bold; cursor: pointer;
            margin: 20px auto; transition: transform 0.1s;
            box-shadow: 0 0 25px var(--accent);
        }
        .mining-button:active { transform: scale(0.95); }
        .mining-feedback { font-size: 24px; color: var(--yellow); opacity: 0; transition: opacity 0.3s, transform 0.3s; position: absolute; }

        /* –ê–ø–≥—Ä–µ–π–¥—ã */
        .upgrade-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #27272a; }
        .upgrade-item:last-child { border-bottom: none; }
        .upgrade-info h4 { margin: 0; font-size: 16px; }
        .upgrade-info p { margin: 5px 0 0; font-size: 12px; color: var(--gray); }
        .upgrade-btn { background: var(--green); padding: 8px 15px; border-radius: 8px; font-size: 14px; cursor: pointer; }
        .upgrade-btn:disabled { background: #27272a; color: #52525b; cursor: not-allowed; }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-entry { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #27272a; font-size: 13px; }
        .history-entry .amount { font-weight: bold; }
        .history-entry .win { color: var(--green); }
        .history-entry .loss { color: var(--red); }
        .history-entry .neutral { color: var(--gray); }

        /* –ö–ª–∞–Ω—ã */
        .clan-list-item { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .clan-name { font-size: 18px; font-weight: bold; }
        .clan-points { color: var(--yellow); }

        /* –†—É–ª–µ—Ç–∫–∞ */
        .roulette-container { position: relative; width: 280px; height: 280px; margin: 20px auto; }
        #roulette-wheel {
            width: 100%; height: 100%; border-radius: 50%;
            background-image: url('https://i.imgur.com/v8tT9oP.png'); /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–µ—Å–∞ —Ä—É–ª–µ—Ç–∫–∏ */
            background-size: cover;
            transition: transform 4s cubic-bezier(0.1, 0.7, 0.1, 1);
        }
        .roulette-pointer {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 15px solid transparent;
            border-right: 15px solid transparent; border-top: 30px solid var(--accent); z-index: 10;
        }

        /* –ú–∏–Ω—ã */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-top: 20px; }
        .mine-cell {
            aspect-ratio: 1; background: #2a2a35; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; border: 1px solid #27272a; cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }
        .mine-cell.open-win { background: #14532d; border-color: var(--green); }
        .mine-cell.open-lose { background: #450a0a; border-color: var(--red); }
        .mine-cell:disabled { cursor: not-allowed; }
        .mine-settings { display: flex; gap: 10px; margin-bottom: 15px; }
        .mine-bet-input { width: 100px; }
        .mine-count-slider { flex-grow: 1; -webkit-appearance: none; height: 8px; background: #333; border-radius: 5px; outline: none; }
        .mine-count-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--accent); cursor: pointer; }
        .mine-count-slider::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: var(--accent); cursor: pointer; }

        /* Dice */
        .dice-display { font-size: 60px; text-align: center; margin-top: 20px; font-weight: bold; color: var(--yellow); }
        .dice-controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
        .dice-bet-btn { flex: 1; min-width: 100px; background: #27272a; color: var(--text); }
        .dice-bet-btn.active { background: var(--accent); }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–õ–ê–í–ù–ê–Ø (–ú–∞–π–Ω–∏–Ω–≥) -->
        <div id="p-main" class="page active">
            <div class="balance-info">
                <div class="balance-label">–í–ê–® –ë–ê–õ–ê–ù–° (USDT)</div>
                <div id="main-balance" class="balance-value">0.00 üí∞</div>
                <div id="main-crypto-balance" class="crypto-balance-value">0.00 BTC</div>
            </div>

            <div class="card mining-area">
                <div id="mining-button" class="mining-button">‚õèÔ∏è</div>
                <p>–ú–æ—â–Ω–æ—Å—Ç—å –∑–∞ –∫–ª–∏–∫: <span id="mining-power">1.0</span> BTC</p>
                <p>–ü–∞—Å—Å–∏–≤–Ω—ã–π –º–∞–π–Ω–∏–Ω–≥: <span id="idle-mining-rate">0.1</span> BTC/—Å–µ–∫</p>
                <div id="mining-feedback-container" style="position: relative; height: 30px;"></div>
            </div>

            <button class="btn" onclick="switchPage('p-shop')">–ú–ê–ì–ê–ó–ò–ù –£–õ–£–ß–®–ï–ù–ò–ô</button>
            <button class="btn" style="background:#facc15; margin-top:10px;" onclick="sellCrypto()">–ü–†–û–î–ê–¢–¨ –ö–†–ò–ü–¢–£</button>
        </div>

        <!-- –ú–ê–ì–ê–ó–ò–ù –£–õ–£–ß–®–ï–ù–ò–ô -->
        <div id="p-shop" class="page">
            <div onclick="switchPage('p-main')" style="color: var(--gray); margin-bottom: 15px; cursor: pointer;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2>–ú–∞–≥–∞–∑–∏–Ω –£–ª—É—á—à–µ–Ω–∏–π üõí</h2>
            <div id="upgrades-list">
                <!-- –£–ª—É—á—à–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –ë–û–ù–£–°–´ -->
        <div id="p-bonuses" class="page">
            <h2>–ë–æ–Ω—É—Å—ã üéÅ</h2>
            <div class="card">
                <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
                <p style="color: var(--gray);">+3,333 USDT –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞</p>
                <div id="bonus-timer" style="font-size: 24px; font-weight: bold; margin: 15px 0; color: var(--yellow);"></div>
                <button id="bonus-btn" class="btn" onclick="claimBonus()">–ü–û–õ–£–ß–ò–¢–¨</button>
            </div>
        </div>

        <!-- –ò–ì–†–´ (–ö–ê–ó–ò–ù–û) -->
        <div id="p-games" class="page">
            <h2>–ö–∞–∑–∏–Ω–æ üé∞</h2>
            <div class="card" onclick="switchPage('g-roulette')"><span>üé° –†—É–ª–µ—Ç–∫–∞</span></div>
            <div class="card" onclick="switchPage('g-mines')"><span>üí£ –ú–∏–Ω—ã</span></div>
            <div class="card" onclick="switchPage('g-dice')"><span>üé≤ Dice (0-12)</span></div>
        </div>

        <!-- –¢–û–ü –ò–ì–†–û–ö–û–í -->
        <div id="p-top" class="page">
            <h2>–¢–æ–ø –ú–∞–π–Ω–µ—Ä–æ–≤ üèÜ</h2>
            <div class="card">
                <p>–†–µ–π—Ç–∏–Ω–≥ –ø–æ –¥–æ–±—ã—Ç–æ–π –∫—Ä–∏–ø—Ç–µ (BTC):</p>
                <div id="top-users-list">
                    <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API -->
                </div>
            </div>
        </div>

        <!-- –ö–õ–ê–ù–´ -->
        <div id="p-clans" class="page">
            <h2>–ö–ª–∞–Ω—ã üë•</h2>
            <div class="card">
                <input type="text" id="clan-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞">
                <button class="btn" onclick="createClan()">–°–û–ó–î–ê–¢–¨ –ö–õ–ê–ù (0 USDT)</button>
            </div>
            <div id="clans-list">
                <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API -->
            </div>
        </div>

        <!-- –ü–†–û–§–ò–õ–¨ -->
        <div id="p-profile" class="page">
            <div onclick="switchPage('p-main')" style="color: var(--gray); margin-bottom: 15px; cursor: pointer;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2>–ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å üë§</h2>
            <div class="card">
                <div class="profile-nick" id="profile-nickname-display"></div>
                <p style="color: var(--gray);">–°–º–µ–Ω–∞ –Ω–∏–∫–∞ –∏ —Ü–≤–µ—Ç–∞ (500 USDT)</p>
                <input type="text" id="profile-new-nick" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫">
                <input type="color" id="profile-new-color" style="height: 50px; padding: 2px;">
                <button class="btn" onclick="saveProfile()">–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø</button>
            </div>
        </div>

        <!-- –ò–ì–†–ê: –†–£–õ–ï–¢–ö–ê -->
        <div id="g-roulette" class="page">
            <div onclick="switchPage('p-games')" style="color: var(--gray); margin-bottom: 15px; cursor: pointer;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2>–†—É–ª–µ—Ç–∫–∞ üé°</h2>
            <div class="roulette-container">
                <div class="roulette-pointer"></div>
                <div id="roulette-wheel"></div>
            </div>
            <button class="btn" onclick="spinRoulette()">–ö–†–£–¢–ò–¢–¨ (100 USDT)</button>
            <div class="card" style="margin-top: 20px;">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
                <div id="roulette-history" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
            </div>
        </div>

        <!-- –ò–ì–†–ê: –ú–ò–ù–´ -->
        <div id="g-mines" class="page">
            <div onclick="switchPage('p-games')" style="color: var(--gray); margin-bottom: 15px; cursor: pointer;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2>–ú–∏–Ω—ã üí£</h2>
            <div class="card">
                <div class="mine-settings">
                    <input type="number" id="mine-bet" class="mine-bet-input" value="100" min="10" max="100000">
                    <input type="range" id="mine-count-slider" class="mine-count-slider" min="1" max="24" value="3">
                    <span id="mine-count-display" style="width: 30px; text-align: right;">3</span>
                </div>
                <div id="mines-multiplier" style="font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 15px;">x1.00</div>
                <button id="mine-start-btn" class="btn" onclick="startMines()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
                <button id="mine-cashout-btn" class="btn" style="background:var(--green); display:none;" onclick="cashoutMines()">–ó–ê–ë–†–ê–¢–¨ <span id="mines-cashout-value"></span></button>
            </div>
            <div class="mines-grid" id="mines-board"></div>
        </div>

        <!-- –ò–ì–†–ê: DICE -->
        <div id="g-dice" class="page">
            <div onclick="switchPage('p-games')" style="color: var(--gray); margin-bottom: 15px; cursor: pointer;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2>Dice (0-12) üé≤</h2>
            <div class="card">
                <div id="dice-result" class="dice-display">?</div>
                <input type="number" id="dice-bet" value="50" min="10" max="10000">
                <div class="dice-controls">
                    <button class="btn dice-bet-btn" data-type="less" data-mult="2.2" onclick="playDice(this)">–ú–µ–Ω—å—à–µ 6 (x2.2)</button>
                    <button class="btn dice-bet-btn" data-type="equal" data-mult="12" onclick="playDice(this)">–†–∞–≤–Ω–æ 6 (x12)</button>
                    <button class="btn dice-bet-btn" data-type="more" data-mult="2.2" onclick="playDice(this)">–ë–æ–ª—å—à–µ 6 (x2.2)</button>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –±—Ä–æ—Å–∫–∏:</h3>
                <div id="dice-history" style="display: flex; flex-wrap: wrap; gap: 5px;"></div>
            </div>
        </div>


        <!-- –û–ë–©–ê–Ø –ò–°–¢–û–†–ò–Ø (–¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä) -->
        <div id="p-history" class="page">
            <div onclick="switchPage('p-main')" style="color: var(--gray); margin-bottom: 15px; cursor: pointer;">‚Üê –ù–∞–∑–∞–¥</div>
            <h2>–ò—Å—Ç–æ—Ä–∏—è üìú</h2>
            <div class="card" id="global-history-list">
                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
            </div>
        </div>

        <!-- –¢–ê–ë-–ë–ê–† -->
        <div class="tab-bar">
            <div class="tab-item active" data-target="p-main"><span>üè†</span>–ì–ª–∞–≤–Ω–∞—è</div>
            <div class="tab-item" data-target="p-bonuses"><span>üéÅ</span>–ë–æ–Ω—É—Å—ã</div>
            <div class="tab-item" data-target="p-games"><span>üéÆ</span>–ò–≥—Ä—ã</div>
            <div class="tab-item" data-target="p-top"><span>üèÜ</span>–¢–æ–ø</div>
            <div class="tab-item" data-target="p-clans"><span>üë•</span>–ö–ª–∞–Ω—ã</div>
        </div>
    </div>

    <script>
        const API_URL = window.location.origin; // –ò–ª–∏ "https://your-ngrok-or-github-domain.io"
        let USER_ID = null; // –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        let USER_USERNAME = "Unknown";
        let USER_DATA = {}; // –•—Ä–∞–Ω–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

        document.addEventListener('DOMContentLoaded', () => {
            tg.expand();
            tg.ready();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Mini App
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                USER_ID = tg.initDataUnsafe.user.id;
                USER_USERNAME = tg.initDataUnsafe.user.username || tg.initDataUnsafe.user.first_name || `Player_${USER_ID}`;
                
                fetch(`${API_URL}/api/init_user`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: USER_ID, username: USER_USERNAME })
                })
                .then(response => response.json())
                .then(data => {
                    USER_DATA = data;
                    updateUI();
                    startBonusTimer();
                    startIdleMining();
                })
                .catch(error => console.error('Error initializing user:', error));
            } else {
                console.error("Telegram WebApp data not available. Running in test mode.");
                // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ Telegram
                USER_ID = 12345; 
                USER_USERNAME = "TestUser";
                USER_DATA = { 
                    user_id: USER_ID, nickname: USER_USERNAME, nick_color: "#FFFFFF",
                    balance: 1000.00, crypto_balance: 50.00,
                    mining_power: 1.0, idle_mining_rate: 0.1,
                    last_bonus_claim: new Date(0).getTime() / 1000 // UNIX timestamp
                };
                updateUI();
                startBonusTimer();
                startIdleMining();
            }

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
            document.querySelectorAll('.tab-item').forEach(item => {
                item.addEventListener('click', () => {
                    const targetPageId = item.getAttribute('data-target');
                    switchPage(targetPageId);
                });
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –º–∞–π–Ω–∏–Ω–≥–∞, —Ç–∞–π–º–µ—Ä–æ–≤ –∏ —Ç.–¥.
            setInterval(updateUI, 1000); 
        });

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ –≤ –Ω–∏–∂–Ω–µ–º –º–µ–Ω—é
            document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`.tab-item[data-target="${pageId}"]`).classList.add('active');

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –≤–∫–ª–∞–¥–æ–∫
            if (pageId === 'p-shop') loadUpgrades();
            if (pageId === 'p-clans') loadClans();
            if (pageId === 'p-top') loadTopUsers();
            if (pageId === 'p-profile') loadProfileData();
            if (pageId === 'p-history') loadGlobalHistory(); // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏
        }

        function updateUI() {
            if (!USER_DATA.user_id) return; // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

            document.getElementById('main-balance').innerText = `${USER_DATA.balance.toFixed(2)} üí∞`;
            document.getElementById('main-crypto-balance').innerText = `${USER_DATA.crypto_balance.toFixed(2)} BTC`;
            document.getElementById('mining-power').innerText = USER_DATA.mining_power.toFixed(2);
            document.getElementById('idle-mining-rate').innerText = USER_DATA.idle_mining_rate.toFixed(2);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∏–∫–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
            document.getElementById('profile-nickname-display').innerText = USER_DATA.nickname;
            document.getElementById('profile-nickname-display').style.color = USER_DATA.nick_color;
        }

        // --- –ì–õ–ê–í–ù–ê–Ø (–ú–ê–ô–ù–ò–ù–ì) ---
        document.getElementById('mining-button').addEventListener('click', () => {
            fetch(`${API_URL}/api/mine_crypto`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID })
            })
            .then(response => response.json())
            .then(data => {
                USER_DATA.crypto_balance = data.crypto_balance;
                updateUI();
                showMiningFeedback();
            })
            .catch(error => console.error('Error mining:', error));
        });

        function showMiningFeedback() {
            const feedbackContainer = document.getElementById('mining-feedback-container');
            const feedback = document.createElement('div');
            feedback.className = 'mining-feedback';
            feedback.innerText = `+${USER_DATA.mining_power.toFixed(2)} BTC`;
            
            const btnRect = document.getElementById('mining-button').getBoundingClientRect();
            feedback.style.left = `${btnRect.left + btnRect.width / 2}px`;
            feedback.style.top = `${btnRect.top + btnRect.height / 2}px`;
            feedback.style.transform = 'translate(-50%, -50%)';
            
            feedbackContainer.appendChild(feedback);

            setTimeout(() => {
                feedback.style.opacity = 1;
                feedback.style.transform = `translate(-50%, -100%) scale(1.2)`;
            }, 10);

            setTimeout(() => {feedback.style.opacity = 0;
                feedback.style.transform = `translate(-50%, -200%) scale(0.8)`;
                feedback.remove();
            }, 600);
        }
        
        // –ü–∞—Å—Å–∏–≤–Ω—ã–π –º–∞–π–Ω–∏–Ω–≥ (–Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –Ω–æ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ)
        function startIdleMining() {
            setInterval(() => {
                USER_DATA.crypto_balance += USER_DATA.idle_mining_rate;
                updateUI();
            }, 1000);
        }

        function sellCrypto() {
            const amountToSell = prompt("–°–∫–æ–ª—å–∫–æ BTC –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å?");
            if (amountToSell === null || isNaN(amountToSell) || parseFloat(amountToSell) <= 0) return;
            
            const sellAmount = parseFloat(amountToSell);

            fetch(`${API_URL}/api/sell_crypto`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID, amount_to_sell: sellAmount })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    USER_DATA.balance = data.balance;
                    USER_DATA.crypto_balance = data.crypto_balance;
                    updateUI();
                    alert(`–í—ã –ø—Ä–æ–¥–∞–ª–∏ ${sellAmount.toFixed(2)} BTC –∑–∞ ${data.fiat_earned.toFixed(2)} USDT. –¶–µ–Ω–∞: ${data.crypto_price.toFixed(2)}`);
                } else {
                    alert(data.message);
                }
            })
            .catch(error => console.error('Error selling crypto:', error));
        }

        // --- –ú–ê–ì–ê–ó–ò–ù –£–õ–£–ß–®–ï–ù–ò–ô ---
        function loadUpgrades() {
            fetch(`${API_URL}/api/get_upgrades`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID })
            })
            .then(response => response.json())
            .then(upgrades => {
                const upgradesList = document.getElementById('upgrades-list');
                upgradesList.innerHTML = '';
                upgrades.forEach(upgrade => {
                    const upgradeElement = document.createElement('div');
                    upgradeElement.className = 'card upgrade-item';
                    upgradeElement.innerHTML = `
                        <div class="upgrade-info">
                            <h4>${upgrade.name} (–£—Ä. ${upgrade.level})</h4>
                            <p>${upgrade.description}</p>
                            <p>+${upgrade.effect_power.toFixed(1)} –∫ –∫–ª–∏–∫—É, +${upgrade.effect_idle.toFixed(1)} –∫ –ø–∞—Å—Å–∏–≤—É</p>
                        </div>
                        <button class="upgrade-btn" onclick="buyUpgrade('${upgrade.id}')" ${USER_DATA.balance < upgrade.cost ? 'disabled' : ''}>
                            –ö—É–ø–∏—Ç—å –∑–∞ ${upgrade.cost.toFixed(2)} üí∞
                        </button>
                    `;
                    upgradesList.appendChild(upgradeElement);
                });
            })
            .catch(error => console.error('Error loading upgrades:', error));
        }

        function buyUpgrade(upgradeId) {
            fetch(`${API_URL}/api/buy_upgrade`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID, upgrade_id: upgradeId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    USER_DATA.balance = data.balance;
                    USER_DATA.mining_power = data.mining_power;
                    USER_DATA.idle_mining_rate = data.idle_mining_rate;
                    updateUI();
                    loadUpgrades(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–ø–≥—Ä–µ–π–¥–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –∏ —Ü–µ–Ω
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    alert(data.message);
                    tg.HapticFeedback.notificationOccurred('error');
                }
            })
            .catch(error => console.error('Error buying upgrade:', error));
        }

        // --- –ë–û–ù–£–°–´ ---
        let bonusTimerInterval;
        function startBonusTimer() {
            bonusTimerInterval = setInterval(() => {
                fetch(`${API_URL}/api/get_bonus_cooldown`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: USER_ID })
                })
                .then(response => response.json())
                .then(data => {
                    const remainingSeconds = data.remaining_seconds;
                    const bonusBtn = document.getElementById('bonus-btn');
                    const timerDisplay = document.getElementById('bonus-timer');

                    if (remainingSeconds <= 0) {
                        bonusBtn.disabled = false;
                        timerDisplay.innerText = "–ë–û–ù–£–° –ì–û–¢–û–í!";
                    } else {
                        bonusBtn.disabled = true;
                        const h = Math.floor(remainingSeconds / 3600);
                        const m = Math.floor((remainingSeconds % 3600) / 60);
                        const s = Math.floor(remainingSeconds % 60);
                        timerDisplay.innerText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                    }
                })
                .catch(error => console.error('Error getting bonus cooldown:', error));
            }, 1000);
        }

        function claimBonus() {
            fetch(`${API_URL}/api/claim_bonus`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID })
            })
            .then(response => response.json())
            .then(data => {
                if (data.amount > 0) {
                    USER_DATA.balance = data.balance;
                    USER_DATA.last_bonus_claim = data.last_bonus_claim;
                    updateUI();
                    alert(`–í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å: ${data.amount} USDT!`);
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    alert("–ë–æ–Ω—É—Å –µ—â–µ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω.");
                    tg.HapticFeedback.notificationOccurred('error');
                }
            })
            .catch(error => console.error('Error claiming bonus:', error));
        }

        // --- –¢–û–ü –ò–ì–†–û–ö–û–í ---
        function loadTopUsers() {
            fetch(`${API_URL}/api/get_top_users`)
            .then(response => response.json())
            .then(topUsers => {
                const topList = document.getElementById('top-users-list');
                topList.innerHTML = '';
                topUsers.forEach((user, index) => {
                    const userElement = document.createElement('div');
                    userElement.className = 'clan-list-item';
                    userElement.innerHTML = `
                        <span>${index + 1}. ${user.nickname}</span>
                        <span class="clan-points">${user.crypto_balance.toFixed(2)} BTC</span>
                    `;
                    topList.appendChild(userElement);
                });
            })
            .catch(error => console.error('Error loading top users:', error));
        }

        // --- –ö–õ–ê–ù–´ ---
        function createClan() {
            const clanName = document.getElementById('clan-name-input').value;
            if (clanName.length < 3) {
                alert("–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ.");
                return;
            }

            fetch(`${API_URL}/api/create_clan`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID, clan_name: clanName })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.success) {
                    document.getElementById('clan-name-input').value = '';
                    loadClans();
                }
            })
            .catch(error => console.error('Error creating clan:', error));
        }

        function loadClans() {
            fetch(`${API_URL}/api/get_clans`)
            .then(response => response.json())
            .then(clans => {
                const clansList = document.getElementById('clans-list');
                clansList.innerHTML = '';
                clans.forEach(clan => {
                    const clanElement = document.createElement('div');
                    clanElement.className = 'clan-list-item';
                    clanElement.innerHTML = `
                        <div>
                            <div class="clan-name">${clan.name}</div>
                            <small style="color:var(--gray);">–õ–∏–¥–µ—Ä: ${clan.leader_nickname}</small>
                        </div>
                        <span class="clan-points">${clan.points.toFixed(2)} Pts</span>
                    `;
                    clansList.appendChild(clanElement);
                });
            })
            .catch(error => console.error('Error loading clans:', error));
        }

        // --- –ü–†–û–§–ò–õ–¨ ---
        function loadProfileData() {
            document.getElementById('profile-new-nick').value = USER_DATA.nickname;
            document.getElementById('profile-new-color').value = USER_DATA.nick_color;
        }

        function saveProfile() {
            const newNick = document.getElementById('profile-new-nick').value;
            const newColor = document.getElementById('profile-new-color').value;

            if (newNick.length < 3) {
                alert("–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –∫–æ—Ä–æ—á–µ 3 —Å–∏–º–≤–æ–ª–æ–≤.");
                return;
            }

            fetch(`${API_URL}/api/update_profile`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID, nickname: newNick, color: newColor })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.success) {
                    USER_DATA.balance = data.balance;
                    USER_DATA.nickname = data.nickname;
                    USER_DATA.nick_color = data.nick_color;
                    updateUI();
                    tg.HapticFeedback.notificationOccurred('success');
                } else {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            })
            .catch(error => console.error('Error updating profile:', error));
        }

        // --- –ò–°–¢–û–†–ò–Ø ---
        function loadGlobalHistory() {
            fetch(`${API_URL}/api/get_user_history`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: USER_ID })
            })
            .then(response => response
            .json())
            .then(history => {
                const historyList = document.getElementById('global-history-list');
                historyList.innerHTML = '';
                history.forEach(entry => {
                    const statusClass = entry.amount >= 0 ? 'win' : 'loss';
                    const sign = entry.amount >= 0 ? '+' : '';
                    const historyElement = document.createElement('div');
                    historyElement.className = 'history-entry';
                    historyElement.innerHTML = `
                        <span>${entry.timestamp} | ${entry.event_type}</span>
                        <span class="amount ${statusClass}">${sign}${entry.amount.toFixed(2)}</span>
                    `;
                    historyList.appendChild(historyElement);
                });
            })
            .catch(error => console.error('Error loading history:', error));
        }

        // --- –ò–ì–†–ê: –†–£–õ–ï–¢–ö–ê ---
        const rouletteNumbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const rouletteColors = {
            0: 'green',
            1: 'red', 3: 'red', 5: 'red', 7: 'red', 9: 'red', 12: 'red', 14: 'red', 16: 'red', 18: 'red',
            19: 'red', 21: 'red', 23: 'red', 25: 'red', 27: 'red', 30: 'red', 32: 'red', 34: 'red', 36: 'red'
        }; // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–Ω—ã–µ

        function spinRoulette() {
            const bet = 100; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞
            if (USER_DATA.balance < bet) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USDT –¥–ª—è —Å—Ç–∞–≤–∫–∏!");
                tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            USER_DATA.balance -= bet;
            updateUI();
            
            const wheel = document.getElementById('roulette-wheel');
            const resultNumber = Math.floor(Math.random() * 37); // 0-36
            const resultIndex = rouletteNumbers.indexOf(resultNumber);

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–≤–æ—Ä–æ—Ç
            const totalRotations = 5 * 360; // 5 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤
            const anglePerNumber = 360 / rouletteNumbers.length;
            const targetAngle = totalRotations - (resultIndex * anglePerNumber); // –£—á–∏—Ç—ã–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ —á–∏—Å–µ–ª –Ω–∞ –∫–æ–ª–µ—Å–µ

            wheel.style.transition = 'transform 4s cubic-bezier(0.1, 0.7, 0.1, 1)';
            wheel.style.transform = `rotate(${targetAngle}deg)`;

            setTimeout(() => {
                wheel.style.transition = 'none'; // –°–±—Ä–æ—Å–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞
                wheel.style.transform = `rotate(${targetAngle % 360}deg)`; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–µ—á–Ω—ã–π —É–≥–æ–ª
                
                let winAmount = 0;
                let outcome = "–ü—Ä–æ–∏–≥—Ä—ã—à";
                // –ü—Ä–∏–º–µ—Ä: –°—Ç–∞–≤–∫–∞ –Ω–∞ –∫—Ä–∞—Å–Ω–æ–µ/—á–µ—Ä–Ω–æ–µ. –ü–æ–∫–∞ —É –Ω–∞—Å –Ω–µ—Ç UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ç–∞–≤–∫–∏, –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ–º —Ä–∞–Ω–¥–æ–º
                const isRed = rouletteColors[resultNumber] === 'red';
                const isBlack = rouletteColors[resultNumber] === undefined && resultNumber !== 0; // –í—Å–µ, —á—Ç–æ –Ω–µ –∫—Ä–∞—Å–Ω–æ–µ –∏ –Ω–µ 0
                const isGreen = resultNumber === 0;

                // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ - –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏–º –Ω–∞ –∫—Ä–∞—Å–Ω–æ–µ
                if (isRed) {
                    winAmount = bet * 2;
                    USER_DATA.balance += winAmount;
                    outcome = "–í–´–ò–ì–†–´–®!";
                }
                
                updateUI();
                addRouletteHistory(resultNumber, winAmount - bet);
                alert(`–í—ã–ø–∞–ª–æ: ${resultNumber} (${rouletteColors[resultNumber] || 'black'}). ${outcome}`);
                tg.HapticFeedback.notificationOccurred(winAmount > 0 ? 'success' : 'error');
            }, 4000);
        }

        let rouletteHistory = [];
        function addRouletteHistory(number, profit) {
            rouletteHistory.unshift({ number, profit });
            if (rouletteHistory.length > 30) rouletteHistory.pop();
            renderRouletteHistory();
        }

        function renderRouletteHistory() {
            const historyDiv = document.getElementById('roulette-history');
            historyDiv.innerHTML = '';
            rouletteHistory.forEach(entry => {
                const span = document.createElement('span');
                span.style.background = entry.number === 0 ? 'var(--green)' : (rouletteColors[entry.number] === 'red' ? 'var(--red)' : '#333');
                span.style.borderRadius = '50%';
                span.style.width = '30px';
                span.style.height = '30px';
                span.style.display = 'flex';
                span.style.alignItems = 'center';
                span.style.justifyContent = 'center';
                span.style.fontWeight = 'bold';
                span.innerText = entry.number;
                historyDiv.appendChild(span);
            });
        }


        // --- –ò–ì–†–ê: –ú–ò–ù–´ ---
        let minesGame = {
            active: false,
            board: [], // true = bomb, false = safe
            opened: 0,
            bet: 0,
            mineCount: 0,
            cells: [], // HTML elements
            currentMultiplier: 1.0
        };

        document.getElementById('mine-count-slider').addEventListener('input', (e) => {
            document.getElementById('mine-count-display').innerText = e.target.value;
        });

        function calculateMinesMultiplier(mineCount, openedCells) {
            if (openedCells === 0) return 1.0;
            let totalCells = 25;
            let safeCells = totalCells - mineCount;
            let mult = 1.0;
            for (let i = 0; i < openedCells; i++) {
                mult *= (totalCells - i) / (safeCells - i);
            }
            return Math.round(mult * 0.97 * 100) / 100; // 3% House Edge, 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        }

        function startMines() {
            minesGame.bet = parseInt(document.getElementById('mine-bet').value);
            minesGame.mineCount = parseInt(document.getElementById('mine-count-slider').value);

            if (USER_DATA.balance < minesGame.bet || minesGame.bet <= 0) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USDT –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞!");
                tg.HapticFeedback.notificationOccurred('error');
                return;
            }
            if (minesGame.mineCount < 1 || minesGame.mineCount > 24) {
                alert("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 24.");
                return;
            }

            USER_DATA.balance -= minesGame.bet;
            updateUI();

            minesGame.active = true;
            minesGame.opened = 0;
            minesGame.currentMultiplier = 1.0;
            document.getElementById('mines-multiplier').innerText = 'x1.00';
            
            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –±–æ–º–±—ã
            let bombPositions = new Set();
            while (bombPositions.size < minesGame.mineCount) {
                bombPositions.add(Math.floor(Math.random() * 25));
            }
            minesGame.board = Array.from({ length: 25 }, (v, k) => bombPositions.has(k));

            renderMinesBoard();
            document.getElementById('mine-start-btn').style.display = 'none';
            document.getElementById('mine-cashout-btn').style.display = 'block';
            document.getElementById('mines-cashout-value').innerText = ` (0.00)`;
        }

        function renderMinesBoard() {
            const boardDiv = document.getElementById('mines-board');
            boardDiv.innerHTML = '';
            minesGame.cells = [];

            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'mine-cell';
                cell.setAttribute('data-index', i);
                cell.onclick = () => clickMineCell(i);
                boardDiv.appendChild(cell);
                minesGame.cells.push(cell);
            }
        }

        function clickMineCell(index) {
            if (!minesGame.active || minesGame.cells[index].classList.contains('open-win') || minesGame.cells[index].classList.contains('open-lose')) {
                return;
            }

            if (minesGame.board[index]) { // –ú–∏–Ω–∞!
                minesGame.active = false;
                minesGame.cells[index].classList.add('open-lose');
                minesGame.cells[index].innerText = 'üí£';
                alert("–í–ó–†–´–í! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.");
                
                // –†–∞—Å–∫—Ä—ã—Ç—å –≤—Å–µ –±–æ–º–±—ã
                minesGame.board.forEach((isBomb, idx) => {
                    if (isBomb && idx !== index) {
                        minesGame.cells[idx].classList.add('open-lose');
                        minesGame.cells[idx].innerText = 'üí£';
                    }
                });

                document.getElementById('mine-start-btn').style.display = 'block';
                document.getElementById('mine-cashout-btn').style.display = 'none';
                tg.HapticFeedback.notificationOccurred('error');

            } else { // –°–µ–π—Ñ
                minesGame.cells[index].classList.add('open-win');
                minesGame.cells[index].innerText = 'üíé';
                minesGame.opened++;
                
                minesGame.currentMultiplier = calculateMinesMultiplier(minesGame.mineCount, minesGame.opened);
                const potentialWin = Math.round(minesGame.bet * minesGame.currentMultiplier);
                document.getElementById('mines-multiplier').innerText = `x${minesGame.currentMultiplier.toFixed(2)}`;
                document.getElementById('mines-cashout-value').innerText = ` (${potentialWin.toFixed(2)})`;
                tg.HapticFeedback.impactOccurred('medium');

                if (minesGame.opened + minesGame.mineCount === 25) { // –í—Å–µ —Å–µ–π—Ñ—ã –æ—Ç–∫—Ä—ã—Ç—ã
                    cashoutMines();
                }
            }
        }

        function cashoutMines() {
            if (!minesGame.active || minesGame.opened === 0) return;

            minesGame.active = false;
            const winAmount = minesGame.bet * minesGame.currentMultiplier;
            USER_DATA.balance += winAmount;
            updateUI();
            alert(`–í–´–ò–ì–†–´–®! –í—ã –∑–∞–±—Ä–∞–ª–∏ ${winAmount.toFixed(2)} USDT.`);
            
            document.getElementById('mine-start-btn').style.display = 'block';
            document.getElementById('mine-cashout-btn').style.display = 'none';
            tg.HapticFeedback.notificationOccurred('success');
        }

        // --- –ò–ì–†–ê: DICE ---
        let diceHistory = [];
        function playDice(button) {
            const bet = parseInt(document.getElementById('dice-bet').value);
            const betType = button.getAttribute('data-type');
            const multiplier = parseFloat(button.getAttribute('data-mult'));

            if (USER_DATA.balance < bet || bet <= 0) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USDT –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞!");
                tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            USER_DATA.balance -= bet;
            updateUI();

            const result = Math.floor(Math.random() * 13); // 0-12
            document.getElementById('dice-result').innerText = result;

            let won = false;
            if (betType === 'less' && result < 6) won = true;
            else if (betType === 'equal' && result === 6) won = true;
            else if (betType === 'more' && result > 6) won = true;

            let profit = 0;
            if (won) {
                profit = bet * multiplier;
                USER_DATA.balance += profit;
                alert(`–í–´–ò–ì–†–´–®! –í—ã–ø–∞–ª–æ: ${result}. –í–∞—à –≤—ã–∏–≥—Ä—ã—à: ${profit.toFixed(2)} USDT.`);
                tg.HapticFeedback.notificationOccurred('success');
            } else {
                alert(`–ü–†–û–ò–ì–†–´–®! –í—ã–ø–∞–ª–æ: ${result}.`);
                tg.HapticFeedback.notificationOccurred('error');
            }
            
            updateUI();
            addDiceHistory(result, profit - bet);
        }

        function addDiceHistory(number, profit) {
            diceHistory.unshift({ number, profit });
            if (diceHistory.length > 30) diceHistory.pop();
            renderDiceHistory();
        }

        function renderDiceHistory() {
            const historyDiv = document.getElementById('dice-history');
            historyDiv.innerHTML = '';
            diceHistory.forEach(entry => {
                const span = document.createElement('span');
                span.style.background = entry.profit >= 0 ? 'var(--green)' : 'var(--red)';
                span.style.borderRadius = '5px';
                span.style.padding = '5px 8px';
                span.style.fontSize = '12px';
                span.style.fontWeight = 'bold';
                span.innerText = entry.number;
                historyDiv.appendChild(span);
            });
        }
    </script>
</body>
</html>